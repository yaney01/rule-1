// 2023-09-20 22:48:46
let pro={icons:"globe.asia.australia",icolor:"#6699FF",GPT:false,nw:true,"è¯´æ˜Ž":"å¯åœ¨æŒä¹…åŒ–æ•°æ®ä¸­æ›´æ”¹æ˜¯å¦åœ¨é¢æ¿ä¸­æ˜¾ç¤ºè¿™æ ·å¯ä»¥ç›´æŽ¥ä½¿ç”¨è¿œç¨‹é“¾æŽ¥ï¼Œä¸ç”¨æ”¾åœ¨æœ¬åœ°å³å¯ä¿®æ”¹ï¼Œè¾“é”™äº†ä¼šè‡ªåŠ¨æ¢å¤é»˜è®¤é‡æ–°è¿è¡ŒåŽé‡å†™JSONé‡Œçš„å‚æ•°å³å¯","icons ä¸ºå›¾æ ‡":"icolor ä¸ºé¢œè‰²","å¼€ä¸º":true,"å…³ä¸º":false,version:20230920},data;(async()=>{try{try{let e=$persistentStore.read("KeyNetisp");data=e?JSON.parse(e):pro;if(data.nw||data.version!==pro.version||typeof data.GPT!=="boolean"||typeof data.icons!=="string"||typeof data.icolor!=="string"){console.log("æ— æ•°æ®æˆ–æ•°æ®é”™è¯¯,æ¢å¤é»˜è®¤");delete pro.nw;$persistentStore.write(JSON.stringify(pro,"",2),"KeyNetisp");data=pro}}catch(e){data=pro}let e=data.GPT,t=data.icons,s=data.icolor;let o="",n="",a="èŠ‚ç‚¹ä¿¡æ¯æŸ¥è¯¢",i="\n---------------------\nä»£ç†é“¾",l="",r="",c="",p="";const u=await tKey("http://ip-api.com/json/?lang=zh-CN",1200);if(u.status==="success"){let{country:e,countryCode:t,regionName:s,query:n,city:a,org:i,isp:r,as:c,tk:p}=u;o=n;let d=getflag(t)+e+" "+a;l=" \t"+sMN(d)+"\nè½åœ°IP: \t"+n+": "+p+"ms"+"\nè½åœ°ISP: \t"+sMN(r)+"\nè½åœ°ASN: \t"+sMN(c)+""}else{console.log("ild"+u);l=""}if(e){const e=await tKey("http://chat.openai.com/cdn-cgi/trace",1e3);const t=["CN","TW","HK","IR","KP","RU","VE","BY"];if(typeof e!=="string"){let{loc:s,tk:o,warp:n,ip:i}=e,l=t.indexOf(s),r="";if(l==-1){r="GPT: "+s+" âœ“"}else{r="GPT: "+s+" Ã—"}if(n="plus"){n="Plus"}a=r+"       âžŸ     Priv: "+n+"   "+o+"ms"}else{a="ChatGPT "+e}}const d=await httpAPI();let f;const g=d.requests.slice(0,6);let y=g.filter((e=>/ip-api\.com/.test(e.URL)));if(y.length>0){const e=y[0];p=": "+e.policyName;if(/\(Proxy\)/.test(e.remoteAddress)){f=e.remoteAddress.replace(" (Proxy)","");i=""}else{f=e.remoteAddress}}else{f="Noip"}let m=false,P="spe",h=false,w="edtest";isv6=false,cn=true,zl="";if(f==="Noip"){m=true}else if(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(f)){h=true}else if(/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(f)){isv6=true}if(f==o){cn=false;zl="ç›´è¿žèŠ‚ç‚¹:"}else{zl="è½åœ°åœ°åŒº:";if(!m||h){const e=await tKey(`https://api-v3.${P}${w}.cn/ip?ip=${f}`,500);if(e.code===0&&e.data.country==="ä¸­å›½"){let{province:t,isp:s,city:o,countryCode:n}=e.data,a=e.tk;cn=true;r="å…¥å£å›½å®¶: \t"+getflag(n)+t+" "+o+"\nå…¥å£IP: \t"+f+": "+a+"ms"+"\nå…¥å£ISP: \t"+s+i+"\n---------------------\n"}else{cn=false;console.log(e);r="å…¥å£IPA Failed\n"}}if((!m||isv6)&&!cn){const e=await tKey(`http://ip-api.com/json/${f}?lang=zh-CN`,1e3);if(e.status==="success"){let{countryCode:t,country:s,city:o,org:n,tk:a,isp:l}=e;let c=s+" "+o;r="å…¥å£å›½å®¶: \t"+getflag(t)+sMN(c)+"\nå…¥å£IP: \t"+f+": "+a+"ms"+"\nå…¥å£ISP: \t"+sMN(l)+i+"\n---------------------\n"}else{console.log(e);r="å…¥å£IPB Failed\n"}}}$done({title:a+p,content:c+n+r+zl+l,icon:t,"icon-color":s})}catch(e){console.log(e.message);$done({title:outgpt+nodeNames,content:local+outbli+outik+outld+zl,icon:icons,"icon-color":icolor})}})(),function e(t,s){if(t.length>s){return t.slice(0,s)}else if(t.length<s){return t.toString().padEnd(s," ")}else{return t}};function sK(e,t){return e.split(" ",t).join(" ").replace(/\.|\,|com|\u4e2d\u56fd/g,"")}async function httpAPI(e="/v1/requests/recent",t="GET",s=null){return new Promise(((o,n)=>{$httpAPI(t,e,s,(e=>{o(e)}))}))}function sMN(e){return e}function getflag(e){const t=e.toUpperCase().split("").map((e=>127397+e.charCodeAt()));return String.fromCodePoint(...t).replace(/ðŸ‡¹ðŸ‡¼/g,"ðŸ‡¨ðŸ‡³")}async function tKey(e,t){let s=1,o=1;const a=new Promise(((a,i)=>{const l=async r=>{try{const s=await Promise.race([new Promise(((t,s)=>{let o=Date.now();$httpClient.get({url:e},((e,n,a)=>{if(e){s(e)}else{let e=Date.now()-o;let s=n.status;switch(s){case 200:let s=n.headers["Content-Type"];switch(true){case s.includes("application/json"):let o=JSON.parse(a);o.tk=e;t(o);break;case s.includes("text/html"):t("text/html");break;case s.includes("text/plain"):let n=a.split("\n");let i=n.reduce(((t,s)=>{let[o,n]=s.split("=");t[o]=n;t.tk=e;return t}),{});t(i);break;case s.includes("image/svg+xml"):t("image/svg+xml");break;default:t("æœªçŸ¥");break}break;case 204:let o={tk:e};t(o);break;case 429:console.log("æ¬¡æ•°è¿‡å¤š");t("æ¬¡æ•°è¿‡å¤š");break;case 404:console.log("404");t("404");break;default:t("nokey");break}}}))})),new Promise(((e,s)=>{setTimeout((()=>s(new Error("timeout"))),t)}))]);if(s){a(s)}else{a("è¶…æ—¶");i(new Error(n.message))}}catch(e){if(r<s){o++;l(r+1)}else{a("æ£€æµ‹å¤±è´¥, é‡è¯•æ¬¡æ•°"+o);i(e)}}};l(0)}));return a}
